<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Diwali!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Dancing+Script:wght@500&family=Tiro+Devanagari+Hindi&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrollbars */
            background-color: #000; /* Fallback */
            /* UPDATED: New background image for a more prominent city view */
            background-image: url('https://images.unsplash.com/photo-1603788024142-9a579a7a9155?q=80&w=1974&auto=format&fit=crop');
            background-size: cover;
            background-position: center bottom;
            background-repeat: no-repeat;
        }

        /* Custom font families */
        .font-cinzel { font-family: 'Cinzel Decorative', cursive; }
        .font-hindi { font-family: 'Tiro Devanagari Hindi', serif; }
        .font-dancing { font-family: 'Dancing Script', cursive; }

        /* Glowing text animation */
        @keyframes glow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(251, 191, 36, 0.8), 0 0 16px rgba(251, 191, 36, 0.8), 0 0 24px rgba(251, 191, 36, 0.6);
            }
            50% {
                text-shadow: 0 0 16px rgba(251, 191, 36, 1), 0 0 24px rgba(251, 191, 36, 1), 0 0 32px rgba(251, 191, 36, 0.8);
            }
        }
        
        /* Softer candle-like glow for the signature */
        @keyframes candle-glow {
            0%, 100% {
                text-shadow: 0 0 3px rgba(253, 230, 138, 0.6), 0 0 6px rgba(253, 230, 138, 0.4);
            }
            50% {
                text-shadow: 0 0 6px rgba(253, 230, 138, 0.8), 0 0 9px rgba(253, 230, 138, 0.6);
            }
        }

        .animate-glow {
            animation: glow 3s ease-in-out infinite;
        }
        
        /* Container for the fireworks canvas */
        #fireworks-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Ensures it stays behind content */
            /* A slight transparent black overlay to make text more readable */
            background-color: rgba(0, 0, 0, 0.2); 
        }

        /* Flickering diya animation */
        .diya-container {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            /* UPDATED: Responsive gap for better spacing on all screen sizes */
            gap: 1rem;
            opacity: 0.9;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.4));
        }
        
        /* On medium screens and up, the gap will be larger */
        @media (min-width: 768px) {
            .diya-container {
                gap: 4rem;
            }
        }


        .diya {
            width: 50px;
            height: 25px;
            background: radial-gradient(ellipse at top, #e9a36d, #b95d20 90%);
            border-radius: 50% 50% 15% 15% / 100% 100% 40% 40%;
            position: relative;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5), inset 0 3px 3px rgba(0, 0, 0, 0.3);
            border-top: 2px solid #f8e1c6;
            border-left: 1px solid #a4501a;
            border-right: 1px solid #a4501a;
            border-bottom: 1px solid #a4501a;
        }

        .diya::after {
            content: '';
            position: absolute;
            top: 20%; left: 15%; right: 15%; height: 40%;
            background: #4a2e19;
            border-radius: 50%;
            filter: blur(1px);
        }

        .flame {
            position: absolute;
            bottom: 75%; left: 50%;
            transform-origin: bottom;
            margin-left: -7.5px;
            width: 15px; height: 35px;
            background: radial-gradient(circle at 50% 100%, #fef08a, #fbbf24, transparent 70%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker 1.5s ease-in-out infinite alternate;
            filter: blur(1px);
        }

        .flame::before {
            content: '';
            position: absolute;
            bottom: 0; left: 50%;
            transform: translateX(-50%);
            width: 60%; height: 40%;
            background: radial-gradient(circle, white, #fdba74 80%);
            border-radius: inherit;
            animation: flicker-core 1.2s ease-in-out infinite alternate;
        }

        @keyframes flicker {
            0%, 100% { transform: scaleY(1) scaleX(1) skewX(0deg); opacity: 1; box-shadow: 0 0 10px #fca5a5, 0 0 20px #f59e0b, 0 0 35px #d97706; }
            50% { transform: scaleY(0.95) scaleX(1.05) skewX(5deg); opacity: 0.85; box-shadow: 0 0 15px #fca5a5, 0 0 25px #f59e0b, 0 0 40px #d97706; }
            75% { transform: scaleY(1.05) scaleX(0.95) skewX(-5deg); opacity: 0.95; box-shadow: 0 0 12px #fca5a5, 0 0 22px #f59e0b, 0 0 38px #d97706; }
        }
        
        @keyframes flicker-core { 0%, 100% { opacity: 0.9; } 50% { opacity: 0.7; } }
        
        /* Styles for the personalization modal */
        #name-modal {
            transition: opacity 0.5s ease-in-out;
        }

        /* Styling for the typing cursor */
        .typed-cursor {
            color: #fef08a;
            animation: candle-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-black">
    <!-- Personalization Modal --><div id="name-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm">
        <div class="bg-gray-800 bg-opacity-80 border border-amber-400/30 rounded-lg shadow-2xl p-8 w-11/12 max-w-md text-center">
            <h3 class="font-cinzel text-amber-300 text-2xl mb-4">A Personal Diwali Greeting</h3>
            <p class="text-yellow-100 mb-6">Enter your name to light up the celebration!</p>
            <div class="space-y-4">
                <input type="text" id="first-name" placeholder="First Name" class="w-full bg-gray-900/50 border border-amber-400/50 text-white placeholder-gray-400 rounded-md px-4 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 outline-none">
                <input type="text" id="last-name" placeholder="Last Name" class="w-full bg-gray-900/50 border border-amber-400/50 text-white placeholder-gray-400 rounded-md px-4 py-2 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 outline-none">
            </div>
            <button id="start-btn" class="mt-6 w-full bg-amber-500 hover:bg-amber-600 text-gray-900 font-bold py-2 px-4 rounded-md transition duration-300 transform hover:scale-105">
                Light Up the Celebration
            </button>
        </div>
    </div>

    <!-- Canvas for Fireworks --><canvas id="fireworks-canvas"></canvas>

    <main class="relative min-h-screen w-full flex flex-col items-center justify-center text-center text-white p-4">
        <div class="z-10">
            <!-- UPDATED: Responsive font sizes for better mobile viewing -->
            <h1 class="font-cinzel text-amber-300 animate-glow text-5xl sm:text-6xl md:text-7xl font-bold tracking-wider">
                Happy Diwali<span id="name-en"></span>!
            </h1>
            <h2 class="font-hindi text-amber-300 animate-glow text-4xl sm:text-5xl md:text-6xl mt-4">
                शुभ दीपावली<span id="name-hi"></span>
            </h2>
            <p class="font-dancing text-yellow-100 text-lg sm:text-2xl md:text-3xl mt-8 sm:mt-12 max-w-2xl mx-auto leading-relaxed">
                <span id="typing-effect"></span>
            </p>
        </div>

        <!-- UPDATED: Diya container now hides on extra-small screens to avoid crowding -->
        <div class="diya-container z-10 hidden xs:flex">
            <div class="diya"><div class="flame"></div></div>
            <div class="diya"><div class="flame" style="animation-delay: 0.3s;"></div></div>
            <div class="diya"><div class="flame" style="animation-delay: 0.1s;"></div></div>
            <div class="diya hidden sm:block"><div class="flame" style="animation-delay: 0.5s;"></div></div>
            <div class="diya hidden sm:block"><div class="flame" style="animation-delay: 0.2s;"></div></div>
            <div class="diya hidden md:block"><div class="flame" style="animation-delay: 0.4s;"></div></div>
            <div class="diya hidden md:block"><div class="flame" style="animation-delay: 0.7s;"></div></div>
            <div class="diya hidden lg:block"><div class="flame" style="animation-delay: 0.6s;"></div></div>
            <div class="diya hidden lg:block"><div class="flame" style="animation-delay: 0.8s;"></div></div>
        </div>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <script src="https://cdn.jsdelivr.net/npm/sanscript@1.0.1/sanscript.js"></script>
    
    <script>
        // Adding a custom breakpoint for extra-small screens in Tailwind
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                theme: {
                    extend: {
                        screens: {
                            'xs': '475px',
                        },
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const startBtn = document.getElementById('start-btn');
            const modal = document.getElementById('name-modal');
            const firstNameEl = document.getElementById('first-name');
            const lastNameEl = document.getElementById('last-name');
            const nameEn = document.getElementById('name-en');
            const nameHi = document.getElementById('name-hi');
            let typed;
            
            const apiKey = "AIzaSyARDjCkXgQX4Fz3I3hAPC2rA3fXMWQil9o";

            // --- Fireworks Script ---
            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');
            let fireworks = [];
            let particles = [];
            let hue = 0; // For color cycling

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            function Fireworks(x, y, targetX, targetY) {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.speed = 2;
                this.angle = Math.atan2(targetY - y, targetX - x);
                this.brightness = random(50, 70);
                this.hue = hue;
                this.exploded = false;
                this.trail = [];
                this.trailLength = 4;
            }

            Fireworks.prototype.update = function() {
                if (this.exploded) return;

                this.trail.push([this.x, this.y]);
                if (this.trail.length > this.trailLength) {
                    this.trail.shift();
                }

                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < this.speed) {
                    this.exploded = true;
                    this.explode();
                } else {
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed;
                }
            };

            Fireworks.prototype.draw = function() {
                if (this.exploded) return;

                ctx.beginPath();
                ctx.moveTo(this.trail[this.trail.length - 1][0], this.trail[this.trail.length - 1][1]);
                ctx.lineTo(this.x, this.y);
                ctx.strokeStyle = `hsl(${this.hue}, 100%, ${this.brightness}%)`;
                ctx.stroke();

                for (let i = 0; i < this.trail.length; i++) {
                    const trailPoint = this.trail[i];
                    const opacity = i / this.trail.length * 0.4;
                    ctx.beginPath();
                    ctx.arc(trailPoint[0], trailPoint[1], 1, 0, Math.PI * 2);
                    ctx.fillStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${opacity})`;
                    ctx.fill();
                }
            };

            Fireworks.prototype.explode = function() {
                for (let i = 0; i < 80; i++) {
                    particles.push(new Particle(this.targetX, this.targetY, this.hue));
                }
            };

            function Particle(x, y, hue) {
                this.x = x;
                this.y = y;
                this.hue = hue;
                this.brightness = random(50, 80);
                this.alpha = 1;
                this.decay = random(0.015, 0.03);
                this.speed = random(1, 10);
                this.angle = random(0, Math.PI * 2);
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.gravity = 0.1;
            }

            Particle.prototype.update = function() {
                this.vx *= 0.98;
                this.vy *= 0.98;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            };

            Particle.prototype.draw = function() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                ctx.fill();
            };

            function animateFireworks() {
                requestAnimationFrame(animateFireworks);
                
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; // A very subtle fade to allow background image to show
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                if (Math.random() < 0.05) { // Controls spawn rate
                    const startX = random(canvas.width * 0.3, canvas.width * 0.7); // Fire from more central areas
                    const startY = canvas.height;
                    const targetX = random(canvas.width * 0.1, canvas.width * 0.9);
                    const targetY = random(canvas.height * 0.1, canvas.height * 0.7);
                    fireworks.push(new Fireworks(startX, startY, targetX, targetY));
                    hue = (hue + random(0, 10)) % 360; // Cycle colors
                }

                for (let i = fireworks.length - 1; i >= 0; i--) {
                    fireworks[i].update();
                    fireworks[i].draw();
                    if (fireworks[i].exploded && fireworks[i].trail.length === 0) {
                        fireworks.splice(i, 1);
                    }
                }

                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();
                    if (particles[i].alpha <= this.decay) {
                        particles.splice(i, 1);
                    }
                }
            }
            animateFireworks();
            // --- End Fireworks Script ---

            async function startGreeting() {
                startBtn.disabled = true;
                startBtn.textContent = 'Lighting up...';

                let firstName = firstNameEl.value.trim() || "Friend";
                let lastName = lastNameEl.value.trim() || "Family";

                const formattedLastName = lastName.charAt(0).toUpperCase() + lastName.slice(1);
                nameEn.textContent = ` ${firstName}`;

                if (apiKey) {
                    try {
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                        const payload = {
                            contents: [{
                                parts: [{
                                    text: `Transliterate the following English name into a single word in the Devanagari script. Provide only the transliterated name and nothing else.\n\nName: "${firstName}"`
                                }]
                            }]
                        };
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                        
                        const result = await response.json();
                        const hindiName = result.candidates[0].content.parts[0].text.trim();
                        nameHi.textContent = ` ${hindiName}`;
                    } catch (e) {
                        console.error("Gemini API call failed, falling back to local transliteration.", e);
                        transliterateLocally(firstName);
                    }
                } else {
                    transliterateLocally(firstName);
                }

                if (typed) {
                    typed.destroy();
                }
                typed = new Typed('#typing-effect', {
                    strings: [
                        `Wishing the ${formattedLastName} Family a festival full of sweet memories,`,
                        `a sky full of brilliant lights,`, 
                        `and a heart full of joy and prosperity.`
                    ],
                    typeSpeed: 75,
                    backSpeed: 25,
                    backDelay: 1500,
                    startDelay: 500,
                    loop: true,
                    cursorChar: '|',
                    showCursor: true,
                });


                modal.style.opacity = '0';
                setTimeout(() => modal.style.display = 'none', 500);
            }

            function transliterateLocally(name) {
                try {
                    const hindiName = Sanscript.t(name.toLowerCase(), 'itrans', 'devanagari');
                    nameHi.textContent = ` ${hindiName}`;
                } catch (e) {
                    console.error("Local transliteration failed.", e);
                    nameHi.textContent = ` ${name}`; // Fallback
                }
            }
            
            startBtn.addEventListener('click', startGreeting);
            [firstNameEl, lastNameEl].forEach(el => {
                el.addEventListener('keyup', (event) => { if (event.key === 'Enter') startBtn.click(); });
            });
        });
    </script>
</body>
</html>

